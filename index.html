<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2196f3">
    <title>Popes, Saints and Miracles - Interactive Map</title>
    
    <!-- MapLibre GL JS - Latest version -->
    <link href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css" rel="stylesheet">
    <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <!-- Google Fonts for better typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/app.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Inline Icon Data - Fallback -->
    <script>
        // Backup icon data in case PNG files don't load
        window.backupIcons = {
            'pope-icon': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAABZ0RVh0Q3JlYXRpb24gVGltZQAwNy8xNy8yNHdBmY4AAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzVxteM2AAAEjklEQVRoge2Y20aqQRSAv6Ekr5iZ5S1vlZmleMvMzCwz8/LyMjMz8/Lyyy+/fAIAAAAASUVORK5CYII=',
            'saint-icon': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAABZ0RVh0Q3JlYXRpb24gVGltZQAwNy8xNy8yNHdBmY4AAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzVxteM2AAAEjklEQVRoge2Y20aqQRSAv6Ekr5iZ5S1vlZmleMvMzCwz8/LyMjMz8/Lyyy+/fAIAAAAASUVORK5CYII=',
            'miracle-icon': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAABZ0RVh0Q3JlYXRpb24gVGltZQAwNy8xNy8yNHdBmY4AAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzVxteM2AAAEjklEQVRoge2Y20aqQRSAv6Ekr5iZ5S1vlZmleMvMzCwz8/LyMjMz8/Lyyy+/fAIAAAAASUVORK5CYII='
        };
    </script>
</head>
<body>
    <!-- Enhanced Legend with Toggle Controls -->
    <div id="legend-v2">
        <h4><i class="fas fa-map-signs"></i> Legend</h4>
        <div id="legend-content" class="panel-content">
            <div class="legend-item-v2">
                <input type="checkbox" id="toggle-popes" class="legend-toggle" checked />
                <span class="legend-circle-v2" style="background: linear-gradient(135deg, #ef5350 0%, #c62828 100%);"></span>
                <img src="popes.png" class="legend-image-v2" alt="Popes" onerror="this.style.display='none'" />
                <label for="toggle-popes" class="legend-text-v2">Popes</label>
            </div>
            <div class="legend-item-v2">
                <input type="checkbox" id="toggle-saints" class="legend-toggle" checked />
                <span class="legend-circle-v2" style="background: linear-gradient(135deg, #66bb6a 0%, #2e7d32 100%);"></span>
                <img src="saints.png" class="legend-image-v2" alt="Saints" onerror="this.style.display='none'" />
                <label for="toggle-saints" class="legend-text-v2">Saints</label>
            </div>
            <div class="legend-item-v2">
                <input type="checkbox" id="toggle-miracles" class="legend-toggle" checked />
                <span class="legend-circle-v2" style="background: linear-gradient(135deg, #42a5f5 0%, #1565c0 100%);"></span>
                <img src="miracles.png" class="legend-image-v2" alt="Miracles" onerror="this.style.display='none'" />
                <label for="toggle-miracles" class="legend-text-v2">Miracles</label>
            </div>
        </div>
    </div>

    <!-- Enhanced Hamburger Menu -->
    <div class="hamburger" onclick="toggleMenu()" title="Open Menu">
        <div></div>
        <div></div>
        <div></div>
    </div>

    <!-- Enhanced Menu Panel -->
    <div class="panel-v2" id="panel-v2">
        <!-- Menu Categories -->
        <div class="menu">
            <ul>
                <li onclick="selectCategory('popes')">
                    <i class="fas fa-crown"></i> Popes
                </li>
                <li onclick="selectCategory('saints')">
                    <i class="fas fa-hands-praying"></i> Saints
                </li>
                <li onclick="selectCategory('miracles')">
                    <i class="fas fa-star"></i> Miracles
                </li>
            </ul>
        </div>

        <!-- Enhanced Search -->
        <div class="search-container">
            <input type="text" id="searchBox" placeholder="Search..." oninput="filterQuest()" />
            <i class="fas fa-search" style="position: absolute; right: 12px; top: 12px; color: #1565c0;"></i>
        </div>

        <!-- Results List -->
        <ul id="dataList"></ul>

        <!-- Enhanced Pagination -->
        <div id="paginationContainer" style="display: none;">
            <button onclick="prevPage()">
                <i class="fas fa-chevron-left"></i> Prev
            </button>
            <span id="pageInfo">Page 1</span>
            <button onclick="nextPage()">
                Next <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- Map Container -->
    <div id="map" class="loading"></div>

    <!-- Optional: Loading Indicator -->
    <div id="loading-indicator" style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(33, 150, 243, 0.9);
        color: white;
        padding: 20px 40px;
        border-radius: 12px;
        font-weight: 600;
        z-index: 10000;
        display: none;
        box-shadow: 0 12px 48px rgba(0,0,0,0.2);
    ">
        <i class="fas fa-spinner fa-spin"></i> Loading map data...
    </div>

    <!-- Enhanced JavaScript Loading -->
    <script>
        // Show loading indicator
        document.getElementById('loading-indicator').style.display = 'block';
        
        // Hide loading indicator when page loads
        window.addEventListener('load', function() {
            setTimeout(() => {
                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('map').classList.remove('loading');
            }, 1000);
        });

        // Enhanced error handling
        window.addEventListener('error', function(e) {
            console.error('Application error:', e.error);
            document.getElementById('loading-indicator').innerHTML = 
                '<i class="fas fa-exclamation-triangle"></i> Error loading application';
        });
    </script>
    
    <!-- Main Application Script -->
    <script src="js/popes-map.js"></script>
</body>
</html>
